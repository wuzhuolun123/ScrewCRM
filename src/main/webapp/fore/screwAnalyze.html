<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>layout 后台大布局 - Layui</title>
    <link rel="stylesheet" href="../layui/css/layui.css">
    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>

</head>

<body class="layui-layout-body">
    <div class="layui-layout layui-layout-admin">
        <div class="layui-header">
            <div class="layui-logo">layui 后台布局</div>
            <!-- 头部区域（可配合layui已有的水平导航） -->
            <ul class="layui-nav layui-layout-left">
                <li class="layui-nav-item"><a href="/fore/addOrderPage.html">新增订单</a></li>
                <li class="layui-nav-item"><a>商品管理</a></li>
                <li class="layui-nav-item"><a href="">用户</a></li>
                <li class="layui-nav-item">
                    <a href="javascript:;">其它系统</a>
                    <dl class="layui-nav-child">
                        <dd><a href="">邮件管理</a></dd>
                        <dd><a href="">消息管理</a></dd>
                        <dd><a href="">授权管理</a></dd>
                    </dl>
                </li>
            </ul>
            <ul class="layui-nav layui-layout-right">
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <img src="http://t.cn/RCzsdCq" class="layui-nav-img">
                        贤心
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="">基本资料</a></dd>
                        <dd><a href="">安全设置</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item"><a href="">退了</a></li>
            </ul>
        </div>

        <div class="layui-side layui-bg-black">
            <div class="layui-side-scroll">
                <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
                <ul class="layui-nav layui-nav-tree" lay-filter="test">
                    <li class="layui-nav-item layui-nav-itemed">
                        <a class="" href="javascript:;"></a>
                        <dl class="layui-nav-child">
                            <dd><a href="/fore/homePage.html">订单管理</a></dd>
                            <dd><a href="/fore/screwPage.html">产品管理</a></dd>
                            <dd><a href="/fore/buyerPage.html">买家管理</a></dd>
                            <dd><a href="">超链接</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item">
                        <a href="/fore/addOrderPage.html">解决方案</a>
                        <dl class="layui-nav-child">
                            <dd><a href="javascript:;">列表一</a></dd>
                            <dd><a href="javascript:;">列表二</a></dd>
                            <dd><a href="">超链接</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item"><a href="">云市场</a></li>
                    <li class="layui-nav-item"><a href="">发布商品</a></li>
                </ul>
            </div>
        </div>

        <div class="layui-body">
            <!-- 内容主体区域 -->
            <div style="padding: 15px;">

                <div class="layui-inline">
                    <label class="layui-form-label">年月选择器</label>
                    <div class="layui-input-inline">
                        <input type="text" class="layui-input" id="test3" placeholder="yyyy-MM">
                    </div>
                </div>

                <div id="main" style="width: 1200px;height:666px;"></div>

            </div>

        </div>


        <div class="layui-footer">
            <!-- 底部固定区域 -->
            © layui.com - 底部固定区域
        </div>
    </div>
    <script src="../js/echarts.js"></script>
    <script src="../layui/layui.js"></script>
    <script type="text/javascript">
        // 基于准备好的dom，初始化echarts实例

        // var option = {
        //             color: ['#3398DB'],
        //             tooltip: {
        //                 trigger: 'axis',
        //                 axisPointer: {            // 坐标轴指示器，坐标轴触发有效
        //                     type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
        //                 }
        //             },
        //             grid: {
        //                 left: '3%',
        //                 right: '4%',
        //                 bottom: '3%',
        //                 containLabel: true
        //             },
        //             xAxis: [
        //                 {
        //                     type: 'category',

        //                     axisTick: {
        //                         alignWithLabel: true
        //                     }
        //                 }
        //             ],
        //             yAxis: [
        //                 {
        //                     type: 'value'
        //                 }
        //             ],
        //             dataset: {
        //                 // dimensions:['day','totalPrice']
        //                 source: [
        //                     { product: 'Matcha Latte', count: 825  },
        //                     { product: 'Milk Tea', count: 235},
        //                     { product: 'Cheese Cocoa', count: 1042 },
        //                     { product: 'Walnut Brownie', count: 988 }
        //                 ]
        //             },
        //             series: [
        //                 {
        //                     // name: '',
        //                     type: 'bar',
        //                     barWidth: '60%',
        //                     encode: {}
        //                 }
        //             ]
        //         };
        //         // 使用刚指定的配置项和数据显示图表。
        //         myChart.setOption(option);


        //截取url中参数的方法
        function getUrlParam(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
            var r = window.location.search.substr(1).match(reg);  //匹配目标参数
            if (r != null) return unescape(r[2]); return null; //返回参数值
        }
        function addDayFor31(xAxisData, yAxisDate, str) {

            for (var i = 1; i <= 31; i++) {
                yAxisDate[i - 1] = 0;
                if (i <= 9) {
                    xAxisData[i - 1] = str + '-0' + i;
                } else {
                    xAxisData[i - 1] = str + '-' + i;
                }

            }

        }
        function addDayFor30(xAxisData, yAxisDate, str) {
            for (var i = 1; i <= 30; i++) {
                yAxisDate[i - 1] = 0;
                if (i <= 9) {
                    xAxisData[i - 1] = str + '-0' + i;
                } else {
                    xAxisData[i - 1] = str + '-' + i;
                }
            }

        }
        function addDayForFeb(xAxisData, yAxisDate, year, str) {
            if ((year % 4 == 0 && year % 100 != 0) || (year % 100 == 0 && year % 400 == 0)) {
                for (var i = 1; i <= 29; i++) {
                    yAxisDate[i - 1] = 0;
                    if (i <= 9) {
                        xAxisData[i - 1] = str + '-0' + i;
                    } else {
                        xAxisData[i - 1] = str + '-' + i;
                    }
                }
            } else {
                for (var i = 1; i <= 28; i++) {
                    yAxisDate[i - 1] = 0;
                    if (i <= 9) {
                        xAxisData[i - 1] = str + '-0' + i;
                    } else {
                        xAxisData[i - 1] = str + '-' + i;
                    }
                }
            }

        }



        $(document).ready(function () {
            //以下3行试试写<script>开头？
            var date = getUrlParam("date");
            var sid = getUrlParam("sid");

            //拼接一个x轴   str：2020-01
            // var str = $("#test3").val();
            var str = date;
            var year = str.trim().substring(0, 4);
            var month = str.trim().substr(5);
            console.log(year);
            console.log(month);
            // 填充str的日期部分
            var xAxisData = new Array();
            var yAxisData = new Array();
            switch (month) {
                case "01": console.log("进入01"); addDayFor31(xAxisData, yAxisData, str); break;;
                case "02": addDayForFeb(xAxisData, yAxisData, year, str); break;;
                case "03": addDayFor31(xAxisData, yAxisData, str); break;;
                case "04": addDayFor30(xAxisData, yAxisData, str); break;;
                case "05": addDayFor31(xAxisData, yAxisData, str); break;;
                case "06": addDayFor30(xAxisData, yAxisData, str); break;;
                case "07": addDayFor31(xAxisData, yAxisData, str); break;;
                case "08": addDayFor31(xAxisData, yAxisData, str); break;;
                case "09": addDayFor30(xAxisData, yAxisData, str); break;;
                case "10": addDayFor31(xAxisData, yAxisData, str); break;;
                case "11": addDayFor30(xAxisData, yAxisData, str); break;;
                case "12": addDayFor31(xAxisData, yAxisData, str); break;;
            }
            console.log(xAxisData);
            console.log(yAxisData);
            var myChart = echarts.init(document.getElementById('main'));
            var options = "day";

            var option = {
                color: ['#3398DB'],
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                        type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                    }
                },
                grid: {
                    top:'0%',
                   left:'5%',
                   bottom:'15%',
                    containLabel: true
                    
                },
                xAxis: [
                    {
                        type: 'category',

                        data: xAxisData,

                        axisTick: {
                            alignWithLabel: true
                        },
                        axisLabel:{interval:0}
                    }
                ],
                yAxis: [
                    {
                        type: 'value'
                    }
                ],

                series: [
                    {
                        type: 'bar',
                        barWidth: '60%',
                        data: yAxisData
                    }
                ]
                // 以上初始化后 x轴： [2020-01-01, ...]   y轴： [0,...] 
            };
            myChart.setOption(option);
           // alert("11");

            $.ajax({
                url: '/screwAnalyze/getData?option=' + options + '&sid=' + sid
                //指定图表的配置项和数据
                , success: function (res) {
                    //  res.data格式为[{totalPrice:800,day:2020-01-01},{}]    
                    console.log(res.data);
                    var index = 0;

   //   Object.keys(js对象) 可得到下标的数组集合
                    // keys 得到下标的数组集合
                    console.log('keys数组：'+Object.keys(res.data[0]));
                    console.log(Object.keys(res.data[0])[0]);
                    console.log('x轴第一个数：'+xAxisData[0]);
                    for (var i in xAxisData) {
                        //console.log('i:'+i);
                        if (xAxisData[i] ==res.data[index][Object.keys(res.data[0])[1] ]) {
                         console.log("进入方法"+Object.keys(res.data[0])[1]);
                            yAxisData[i]=res.data[index][ Object.keys(res.data[index])[0]];
                            index++;
                        }
                        if (index == res.data.length-1) {
                            break;
                        }
                        
                    }
                    console.log(yAxisData);
                    var option = {
                        series: [
                            {
                                type: 'bar',
                                barWidth: '60%',
                                data: yAxisData
                            }
                        ]
                    };
                    // 使用刚指定的配置项和数据显示图表。
                    myChart.setOption(option);
                }
            });

        });


    </script>
    <script type="text/javascript">

        layui.use(['table', 'laydate', 'form'], function () {
            var table = layui.table;
            //  var status = $("#place").find("option:selected").val();
            table.render({
                elem: '#table1'
                , url: '/screw/getScrewList'
                , cols: [[
                    { field: 'sid', title: '编号', sort: true }


                    , { field: 'name', title: '名称' }
                    , { field: 'spec', title: '规格' }
                    , { field: 'thousandPerPrice', title: '单价', sort: true }

                    , { field: 'remark', title: '备注' }
                    , { field: 'toolbar', title: '工具栏', toolbar: '#editOrDelete' }
                    , { field: 'totalPrice', title: '销售金额', sort: true }
                ]]

                , page: true
            });

            table.on('tool(table1)', function (obj) {
                var event = obj.event;// lay-event 对应的值
                var data = obj.data; //当前行数据
                var tr = obj.tr; //当前行 tr 的 DOM 对象
                var sid = obj.data.sid;
                if (event === 'edit') {
                    console.log(obj.data);

                    var name = obj.data.name;
                    var spec = obj.data.spec;
                    var thousandPerPrice = obj.data.thousandPerPrice;
                    var remark = obj.data.remark;

                    showEditModal(sid, name, spec, thousandPerPrice, remark);



                } else if (event === 'del') {
                    layer.confirm('确定删除？', {
                        btn: ['确定', '取消']
                    }, function (index) {
                        $.ajax({
                            url: '/screw/deleteScrew?sid=' + sid
                            , success: function (res) {
                                if (res.status == 200) {
                                    layer.msg('删除成功', { icon: 1 });
                                    obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                                    layer.close(index); //?
                                } else {
                                    layer.msg('删除失败', { icon: 1 });
                                }
                            }

                        });
                    });
                } else if (event == 'queryOrderListByCondition') {
                    //查看相关订单
                }
            });

            // 日期模块
            var laydate = layui.laydate;
            laydate.render({
                elem: '#test3'
                , type: 'month'
            });
            var form = layui.form;
            //添加/编辑表单提交时
            form.on('submit(formDemo)', function (data) {
                console.log(data.elem) //被执行事件的元素DOM对象，一般为button对象
                console.log(data.form) //被执行提交的form对象，一般在存在form标签时才会返回
                console.log(data.field) //当前容器的全部表单字段，名值对形式：{name: value}



                var strData = JSON.stringify(data.field);
                console.log(strData);

                layer.confirm('确定操作？', {
                    btn: ['确定', '取消']
                }, function (index) {
                    $.ajax({
                        url: '/screw/addOrSaveScrew'
                        , data: strData
                        , method: 'post'
                        , contentType: 'application/json'
                        , success: function (res) {
                            console.log(res.status);
                            //添加操作回调
                            if (res.action == "add") {
                                if (res.status == 200) {
                                    layer.msg('添加成功', { icon: 1 });
                                    //   form.render(null, 'form1'); 
                                    setTimeout(function () { window.location.href = '/admin/screwPage' }, 1000);

                                } else {
                                    layer.msg('添加失败', { icon: 1 });
                                }
                                //编辑操作回调
                            } else if (res.action == "edit") {
                                if (res.status == 200) {
                                    layer.msg('编辑成功', { icon: 1 });
                                    //   form.render(null, 'form1'); 
                                    setTimeout(function () { window.location.href = '/admin/screwPage' }, 1000);

                                } else {
                                    layer.msg('编辑失败', { icon: 1 });
                                }
                            }


                            //    setTimeout(function(){window.location.href='/admin/buyerPage'},1000);
                        }

                    });
                });

                return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。

            });


        });

    </script>
    <script type="text/html" id="editOrDelete">
        <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="queryOrderListByCondition">查看相关订单</a>
      
      </script>


</body>


</html>